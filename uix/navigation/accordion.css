:where(.uix-accordion) {
  /* --- 1. Layout Variables --- */
  display: flex;
  width: 100%;
  --accordion-border-radius: var(--radius-md, 0.375rem);
  --accordion-padding: 0.25rem 0.5rem;
  --accordion-gap: 0; /* Default to flush items */

  /* --- 2. Color Variables (Scoped) --- */
  /* Container */
  --accordion-bg: transparent;
  --accordion-border-color: transparent; /* Lighter stop for visibility on dark bg */

  /* Headers */
  --header-bg: transparent;
  --header-text: var(--color-surface-lighter); /* High readability */
  --header-border-top: var(--color-surface-dark); /* Subtle separator */

  /* Header Interactions */
  --header-bg-hover: var(--color-surface-dark); /* Lighter grey */
  --header-text-hover: var(--color-inverse);

  --header-bg-active: var(--color-surface-darker); /* Distinct active background */
  --header-text-active: var(--color-inverse);

  /* Panels */
  --panel-bg: transparent;
  --panel-text: var(--color-surface-lighter); /* Slightly muted readable text */

  /* Transition */
  --accordion-transition: background-color 0.2s ease, color 0.2s ease,
    border-color 0.2s ease;
}

/* --- 3. Container Structure --- */
.uix-accordion::part(container) {
  display: flex;
  flex-direction: column;
  width: 100%;
  gap: var(--accordion-gap);

  background: var(--accordion-bg);
  border: 1px solid var(--accordion-border-color);
  border-radius: var(--accordion-border-radius);
  overflow: hidden;
}

/* --- 4. Headers (Odd Children) --- */
.uix-accordion > *:nth-child(odd) {
  display: flex;
  width: 100%;
  text-align: left;
  cursor: pointer;
  user-select: none;

  padding: var(--accordion-padding);
  font-size: var(--typography-fontSize-base, 1rem);
  font-weight: var(--typography-fontWeight-medium, 500);

  background: var(--header-bg);

  border: none;
  border-top: 1px solid var(--header-border-top);
  transition: var(--accordion-transition);
}

/* Remove top border from the very first header */
.uix-accordion > *:nth-child(1) {
  border-top: none;
}

/* Header States */
.uix-accordion > *:nth-child(odd):hover {
  background: var(--header-bg-hover);
}

.uix-accordion > *:nth-child(odd)[active] {
  &[activeBg] {
    background: var(--header-bg-active);
  }
}

/* --- 5. Panels (Even Children) --- */
.uix-accordion > *:nth-child(even) {
  > * {
    padding-left: 40px;
    padding-block: 0.5rem;
  }
  background: var(--panel-bg);
  color: var(--panel-text);

  font-size: var(--typography-fontSize-sm, 0.875rem);
  line-height: var(--typography-lineHeight-relaxed, 1.6);

  /* Animation handled by JS or height transition, but color needs transition */
  transition: var(--accordion-transition);
}

.uix-accordion > *:nth-child(even)[hide] {
  display: none;
}

/* --- 6. Variants --- */

/* Variant: Bordered */
/* Stronger borders, transparent backgrounds */
.uix-accordion[variant="bordered"] {
  --accordion-border-color: var(--color-surface-dark);
  --header-border-top: var(--color-surface-dark);
  --header-bg-hover: var(--color-surface-dark);
  --header-bg-active: var(--color-surface-darker);
}

.uix-accordion[variant="bordered"]::part(container) {
  border-width: 2px;
}

.uix-accordion[variant="bordered"] > *:nth-child(odd) {
  border-top-width: 1px; /* Keep internal separators thin */
}

/* Variant: Filled */
/* Darker container, lighter active items (Depth effect) */
.uix-accordion[variant="filled"] {
  /* Make the container slightly darker than the page background */
  --accordion-bg: var(--color-surface-lighter);
  --accordion-border-color: transparent;

  --header-border-top: var(--color-surface-light); /* Very subtle */

  /* Active item "pops" out by becoming the normal surface color */
  --header-bg-active: var(--color-surface);
  --panel-bg: var(--color-surface);

  --header-bg-hover: var(--color-surface);
}

.uix-accordion[variant="filled"] > *:nth-child(odd)[active] {
  /* Optional: Add shadow to active filled header */
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

/* Variant: Flush */
/* No borders, no background, no padding on container - for embedding in sidebars */
.uix-accordion[variant="flush"] {
  --accordion-bg: transparent;
  --accordion-border-color: transparent;
  --accordion-padding: 0;
  --header-border-top: transparent;
  --header-bg: transparent;
  --header-bg-hover: var(--color-surface-light);
  --header-bg-active: var(--color-surface);
  --panel-bg: transparent;
}

.uix-accordion[variant="flush"]::part(container) {
  border: none;
  padding: 0;
}

.uix-accordion[variant="flush"] > *:nth-child(odd) {
  border-top: none;
}

.uix-accordion[variant="flush"] > *:nth-child(1) {
  border-top: none;
}

/* Variant: Separated */
/* Items have gaps between them, good for card-like accordion */
.uix-accordion[variant="separated"] {
  --accordion-gap: var(--spacing-sm, 0.5rem);
  --accordion-border-color: transparent;
  --header-border-top: transparent;
}

.uix-accordion[variant="separated"]::part(container) {
  border: none;
  padding: var(--spacing-sm, 0.5rem);
}

.uix-accordion[variant="separated"] > *:nth-child(odd) {
  border: 1px solid var(--color-surface-dark);
  border-radius: var(--accordion-border-radius);
  border-top: 1px solid var(--color-surface-dark);
}

.uix-accordion[variant="separated"] > *:nth-child(even) {
  border: 1px solid var(--color-surface-dark);
  border-top: none;
  border-radius: 0 0 var(--accordion-border-radius)
    var(--accordion-border-radius);
}

.uix-accordion:not([rounded]) {
  --accordion-border-radius: 0;
}

.uix-accordion:not([rounded])::part(container) {
  border-radius: 0;
}
